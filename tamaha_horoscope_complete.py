
import streamlit as st
from datetime import datetime, date

# å®¿å‘½æ•°ã®åˆ†é¡
role_groups = {
    "ãƒªãƒ¼ãƒ€ãƒ¼": [1, 6, 9],
    "ã‚µãƒãƒ¼ã‚¿ãƒ¼": [2, 4, 7],
    "ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼": [3, 5, 8]
}

# å®¿å‘½æ•°ã«å¯¾å¿œã™ã‚‹ä¸€è¨€
shukumei_messages = {
    1: "è‡ªåˆ†ã‚’ä¿¡ã˜ã¦çªãé€²ã‚ï¼å…ˆé§†è€…ã®é“ã¯ã‚ãªãŸãŒåˆ‡ã‚Šæ‹“ãã€‚",
    2: "æ”¯ãˆã‚‹åŠ›ãŒå¼·ã¿ã€‚ç„¡ç†ã«å‰ã«å‡ºãªãã¦ã‚‚ã€é™°ã®åŠ›ãŒå…‰ã‚‹ï¼",
    3: "è‡ªç”±ã¨æ¥½ã—ã•ãŒéµã€‚å‹ã«ã¯ã¾ã‚‰ãšã€è‡ªåˆ†ã®æ„Ÿæ€§ã‚’ä¿¡ã˜ã‚ˆã†ã€‚",
    4: "åœ°é“ãªåŠªåŠ›ãŒå®Ÿã‚’çµã¶ã€‚ç„¦ã‚‰ãšã€ä¸€æ­©ãšã¤ç¢ºå®Ÿã«å‰é€²ã‚’ï¼",
    5: "å¤‰åŒ–ã‚’æã‚Œãšã€æ–°ã—ã„ä¸–ç•Œã¸é£›ã³è¾¼ã‚‚ã†ï¼æŸ”è»Ÿã•ãŒæ­¦å™¨ã€‚",
    6: "äººã‚’æ”¯ãˆã‚‹ã®ã¯ç´ æ™´ã‚‰ã—ã„ã€‚ã§ã‚‚ã€è‡ªåˆ†ã‚’å¤§äº‹ã«ã™ã‚‹ã“ã¨ã‚‚å¿˜ã‚Œãšã«ï¼",
    7: "ä¸€äººã®æ™‚é–“ãŒã‚ãªãŸã‚’æˆé•·ã•ã›ã‚‹ã€‚å†…ãªã‚‹å£°ã«è€³ã‚’å‚¾ã‘ã¦ã€‚",
    8: "æˆåŠŸã‚’ã¤ã‹ã‚€åŠ›ã‚ã‚Šï¼è‡ªä¿¡ã‚’æŒã£ã¦å ‚ã€…ã¨ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã‚ˆã†ã€‚",
    9: "ã™ã¹ã¦ã‚’å—ã‘å…¥ã‚Œã‚‹å¤§ããªæ„›ã‚’æŒã¤äººã€‚æ‰‹æ”¾ã™ã“ã¨ã§æ–°ãŸãªé“ãŒé–‹ãï¼",
    11: "ç›´æ„Ÿã¨ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ãªæ„Ÿæ€§ãŒå°ãé“ã€‚äººã‚’ç™’ã™åŠ›ãŒã‚ã‚‹ãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ã€‚",
    22: "ä¸–ç•Œã‚’å‹•ã‹ã™å¯èƒ½æ€§ã‚’ç§˜ã‚ãŸãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã€‚ãƒ“ã‚¸ãƒ§ãƒ³ã‚’ä¿¡ã˜ã¦è¡Œå‹•ã‚’ã€‚",
    33: "æ„›ã¨å¥‰ä»•ã®ã‚«ãƒªã‚¹ãƒã€‚ã¿ã‚“ãªã®å¹¸ã›ã®ãŸã‚ã«å¤§ããªåŠ›ã‚’ç™ºæ®ã™ã‚‹ãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ã€‚"
}

# æ˜Ÿåº§åˆ¤å®š
def get_zodiac_sign(month, day):
    signs = [
        ((1, 20), "å±±ç¾Šåº§"), ((2, 19), "æ°´ç“¶åº§"), ((3, 21), "é­šåº§"), ((4, 20), "ç‰¡ç¾Šåº§"),
        ((5, 21), "ç‰¡ç‰›åº§"), ((6, 22), "åŒå­åº§"), ((7, 23), "èŸ¹åº§"), ((8, 23), "ç…å­åº§"),
        ((9, 23), "ä¹™å¥³åº§"), ((10, 24), "å¤©ç§¤åº§"), ((11, 23), "è åº§"), ((12, 22), "å°„æ‰‹åº§"),
        ((12, 32), "å±±ç¾Šåº§")  # Year-end catch
    ]
    for (m, d), sign in signs:
        if (month, day) < (m, d):
            return prev
        prev = sign
    return "å±±ç¾Šåº§"

# æ•°ç§˜ã®è¨ˆç®—
def calc_numerology(value):
    while value > 9 and value not in [11, 22, 33]:
        value = sum(int(d) for d in str(value))
    return value

st.title("ğŸ”® TAMAHAã®æ˜Ÿåº§ã¨å®¿å‘½æ•°")

name = st.text_input("ãŠåå‰ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§ã‚‚OKï¼‰", "ã‚²ã‚¹ãƒˆ")
birth_date = st.date_input("ç”Ÿå¹´æœˆæ—¥ã‚’é¸ã‚“ã§ãã ã•ã„", value=date(2000, 1, 1), min_value=date(1900, 1, 1))

if st.button("è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆï¼"):
    month, day = birth_date.month, birth_date.day
    zodiac = get_zodiac_sign(month, day)

    # æ•°ç§˜ã®è¨ˆç®—
    destiny = calc_numerology(birth_date.year + birth_date.month + birth_date.day)
    mission = calc_numerology(birth_date.month + birth_date.day)
    fate = calc_numerology(birth_date.day)

    # å®¿å‘½æ•°ã‚’å½¹å‰²åˆ†é¡ï¼ˆ11â†’2, 22â†’4, 33â†’6ï¼‰
    role_number = {11: 2, 22: 4, 33: 6}.get(fate, fate)
    role = next((k for k, v in role_groups.items() if role_number in v), "ä¸æ˜")
    fate_msg = shukumei_messages.get(fate, "ç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¤æ•°å­—ã§ã™ã€‚")

    st.subheader(f"ğŸŒŸ {name}ã•ã‚“ã®çµæœ ğŸŒŸ")
    st.write(f"æ˜Ÿåº§ï¼š**{zodiac}**")
    st.write(f"å®¿å‘½æ•°ï¼š**{fate}ï¼ˆ{role}ï¼‰**")
    st.write(f"é‹å‘½æ•°ï¼š**{destiny}**")
    st.write(f"ä½¿å‘½æ•°ï¼š**{mission}**")

    st.write(f"ğŸ” ã‚ãªãŸã®å½¹å‰²ï¼š**{role}**ï¼ˆå®¿å‘½æ•°{', '.join(map(str, role_groups[role]))}ï¼‰")
    st.write(f"ğŸ“ å®¿å‘½æ•°ã‹ã‚‰ã®ã²ã¨ã“ã¨ï¼š{fate_msg}")
