import streamlit as st
from datetime import datetime
import calendar

st.set_page_config(page_title="TAMAHAã®æ˜Ÿåº§ã¨å®¿å‘½æ•°", page_icon="ğŸ”®")

def calc_life_path_number(year, month, day):
    total = sum(int(d) for d in f"{year}{month:02d}{day:02d}")
    while total > 9 and total not in [11, 22, 33]:
        total = sum(int(d) for d in str(total))
    return total

def calc_destiny_number(day):
    if day in [11, 22, 33]:
        return day
    while day > 9:
        day = sum(int(d) for d in str(day))
    return day

def calc_mission_number(month, day):
    total = month + day
    while total > 9 and total not in [11, 22, 33]:
        total = sum(int(d) for d in str(total))
    return total

def get_zodiac_sign(month, day):
    zodiac = [
        ((1, 20), (2, 18), "æ°´ç“¶åº§"),
        ((2, 19), (3, 20), "é­šåº§"),
        ((3, 21), (4, 19), "ç‰¡ç¾Šåº§"),
        ((4, 20), (5, 20), "ç‰¡ç‰›åº§"),
        ((5, 21), (6, 21), "åŒå­åº§"),
        ((6, 22), (7, 22), "èŸ¹åº§"),
        ((7, 23), (8, 22), "ç…å­åº§"),
        ((8, 23), (9, 22), "ä¹™å¥³åº§"),
        ((9, 23), (10, 23), "å¤©ç§¤åº§"),
        ((10, 24), (11, 22), "è åº§"),
        ((11, 23), (12, 21), "å°„æ‰‹åº§"),
        ((12, 22), (1, 19), "å±±ç¾Šåº§")
    ]
    for start, end, sign in zodiac:
        if (month == start[0] and day >= start[1]) or (month == end[0] and day <= end[1]):
            return sign
    return "ä¸æ˜"

destiny_roles = {
    1: "ãƒªãƒ¼ãƒ€ãƒ¼ï¼ˆå®¿å‘½æ•°1ï¼‰: ç‹¬ç«‹å¿ƒã¨å‰µé€ æ€§ã€è‡ªå·±ä¸»å¼µãŒå¼·ãæ–°ã—ã„é“ã‚’åˆ‡ã‚Šé–‹ãåŠ›ã€‚",
    2: "ã‚µãƒãƒ¼ã‚¿ãƒ¼ï¼ˆå®¿å‘½æ•°2ï¼‰: å”èª¿æ€§ãŒé«˜ãã€ç›¸æ‰‹ã«å¯„ã‚Šæ·»ã†åŠ›ãŒå¼·ã¿ã€‚",
    3: "ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆå®¿å‘½æ•°3ï¼‰: æ¥½ã—ã„é›°å›²æ°—ã‚’ã¤ãã‚‹å¤©æ‰ã€‚æ˜ã‚‹ãç¤¾äº¤çš„ã€‚",
    4: "ã‚µãƒãƒ¼ã‚¿ãƒ¼ï¼ˆå®¿å‘½æ•°4ï¼‰: åœ°é“ãªåŠªåŠ›ã¨å®‰å®šã‚’é‡ã‚“ã˜ã‚‹å®Ÿç›´ãªæ”¯ãˆæ‰‹ã€‚",
    5: "ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆå®¿å‘½æ•°5ï¼‰: è¡Œå‹•åŠ›ãŒã‚ã‚Šã€æ–°ã—ã„é¢¨ã‚’å¹ã‹ã›ã‚‹æ”¹é©è€…ã€‚",
    6: "ãƒªãƒ¼ãƒ€ãƒ¼ï¼ˆå®¿å‘½æ•°6ï¼‰: æ„›æƒ…æ·±ãé¢å€’è¦‹ãŒè‰¯ã„ã€‚èª¿å’Œã‚’ä¿ã¤çµ±ç‡è€…ã€‚",
    7: "ã‚µãƒãƒ¼ã‚¿ãƒ¼ï¼ˆå®¿å‘½æ•°7ï¼‰: æ·±ã„æ´å¯ŸåŠ›ã¨å†·é™ã•ã§å‘¨å›²ã‚’æ”¯ãˆã‚‹çŸ¥æµè€…ã€‚",
    8: "ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ï¼ˆå®¿å‘½æ•°8ï¼‰: ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ã«äººã‚’å·»ãè¾¼ã‚€å½±éŸ¿åŠ›ã®æŒã¡ä¸»ã€‚",
    9: "ãƒªãƒ¼ãƒ€ãƒ¼ï¼ˆå®¿å‘½æ•°9ï¼‰: ç†æƒ³ã‚’è¿½æ±‚ã—ã€çš†ã‚’å°ãæ…ˆæ„›ã‚ã‚‹å“²å­¦è€…ã€‚",
    11: "ã‚µãƒãƒ¼ã‚¿ãƒ¼ï¼ˆå®¿å‘½æ•°11ï¼‰: ç›´æ„Ÿã¨ç²¾ç¥æ€§ã®é«˜ã•ã§æ”¯ãˆã‚‹ãƒã‚¹ã‚¿ãƒ¼ãƒŠãƒ³ãƒãƒ¼ã€‚",
    22: "ã‚µãƒãƒ¼ã‚¿ãƒ¼ï¼ˆå®¿å‘½æ•°22ï¼‰: ä¸–ç•Œã‚’å‹•ã‹ã™åŠ›ã‚’ç§˜ã‚ãŸãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã€‚",
    33: "ãƒªãƒ¼ãƒ€ãƒ¼ï¼ˆå®¿å‘½æ•°33ï¼‰: ç„¡å„Ÿã®æ„›ã§äººã€…ã‚’å°ãã‚«ãƒªã‚¹ãƒçš„å­˜åœ¨ã€‚"
}

destiny_messages = {
    1: "è‡ªåˆ†ã‚’ä¿¡ã˜ã¦çªãé€²ã‚ï¼å…ˆé§†è€…ã®é“ã¯ã‚ãªãŸãŒåˆ‡ã‚Šæ‹“ãã€‚",
    2: "æ”¯ãˆã‚‹åŠ›ãŒå¼·ã¿ã€‚ç„¡ç†ã«å‰ã«å‡ºãªãã¦ã‚‚ã€é™°ã®åŠ›ãŒå…‰ã‚‹ï¼",
    3: "è‡ªç”±ã¨æ¥½ã—ã•ãŒéµã€‚å‹ã«ã¯ã¾ã‚‰ãšã€è‡ªåˆ†ã®æ„Ÿæ€§ã‚’ä¿¡ã˜ã‚ˆã†ã€‚",
    4: "åœ°é“ãªåŠªåŠ›ãŒå®Ÿã‚’çµã¶ã€‚ç„¦ã‚‰ãšã€ä¸€æ­©ãšã¤ç¢ºå®Ÿã«å‰é€²ã‚’ï¼",
    5: "å¤‰åŒ–ã‚’æã‚Œãšã€æ–°ã—ã„ä¸–ç•Œã¸é£›ã³è¾¼ã‚‚ã†ï¼æŸ”è»Ÿã•ãŒæ­¦å™¨ã€‚",
    6: "äººã‚’æ”¯ãˆã‚‹ã®ã¯ç´ æ™´ã‚‰ã—ã„ã€‚ã§ã‚‚ã€è‡ªåˆ†ã‚’å¤§äº‹ã«ã™ã‚‹ã“ã¨ã‚‚å¿˜ã‚Œãšã«ï¼",
    7: "ä¸€äººã®æ™‚é–“ãŒã‚ãªãŸã‚’æˆé•·ã•ã›ã‚‹ã€‚å†…ãªã‚‹å£°ã«è€³ã‚’å‚¾ã‘ã¦ã€‚",
    8: "æˆåŠŸã‚’ã¤ã‹ã‚€åŠ›ã‚ã‚Šï¼è‡ªä¿¡ã‚’æŒã£ã¦å ‚ã€…ã¨ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã‚ˆã†ã€‚",
    9: "ã™ã¹ã¦ã‚’å—ã‘å…¥ã‚Œã‚‹å¤§ããªæ„›ã‚’æŒã¤äººã€‚æ‰‹æ”¾ã™ã“ã¨ã§æ–°ãŸãªé“ãŒé–‹ãï¼",
    11: "ç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¤æ•°å­—ã€‚ç›´æ„ŸåŠ›ã‚’ä¿¡ã˜ã€å°ã‹ã‚Œã‚‹ã‚ˆã†ã«è¡Œå‹•ã—ã‚ˆã†ã€‚",
    22: "ä¸–ç•Œã‚’å‹•ã‹ã™å¯èƒ½æ€§ã‚’ç§˜ã‚ãŸãƒã‚¹ã‚¿ãƒ¼ãƒ—ãƒ©ãƒ³ãƒŠãƒ¼ã€‚ãƒ“ã‚¸ãƒ§ãƒ³ã‚’ä¿¡ã˜ã¦è¡Œå‹•ã‚’ã€‚",
    33: "ç„¡å„Ÿã®æ„›ã§äººã‚’ç™’ã™åŠ›ã€‚ä¸ãˆã‚‹ã“ã¨ã§è‡ªåˆ†ã‚‚æº€ãŸã•ã‚Œã¦ã„ãã€‚"
}

st.title("ğŸ”® TAMAHAã®æ˜Ÿåº§ã¨å®¿å‘½æ•°")

name = st.text_input("ãŠåå‰ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§ã‚‚OKï¼‰", "ã‚²ã‚¹ãƒˆ")
birthdate = st.date_input("ç”Ÿå¹´æœˆæ—¥ã‚’é¸ã‚“ã§ãã ã•ã„", min_value=datetime(1900, 1, 1))

if st.button("è¨ºæ–­ã‚¹ã‚¿ãƒ¼ãƒˆï¼"):
    year = birthdate.year
    month = birthdate.month
    day = birthdate.day

    zodiac = get_zodiac_sign(month, day)
    destiny = calc_destiny_number(day)
    life_path = calc_life_path_number(year, month, day)
    mission = calc_mission_number(month, day)

    role = destiny_roles.get(destiny, "ä¸æ˜")
    role_msg = destiny_messages.get(destiny, "ã‚ãªãŸã®é­…åŠ›ã‚’æ´»ã‹ã—ã¦é€²ã¿ã¾ã—ã‚‡ã†ï¼")

    st.subheader(f"âœ¨ {name}ã•ã‚“ã®çµæœ âœ¨")
    st.markdown(f"**æ˜Ÿåº§ï¼š** {zodiac}")
    st.markdown(f"**å®¿å‘½æ•°ï¼š** {destiny}ï¼ˆ{role}ï¼‰")
    st.markdown(f"**é‹å‘½æ•°ï¼š** {life_path}")
    st.markdown(f"**ä½¿å‘½æ•°ï¼š** {mission}")
    st.markdown(f"ğŸ” **ã‚ãªãŸã®å½¹å‰²ï¼š** {role}")
    st.markdown(f"ğŸ“œ **å®¿å‘½æ•°ã‹ã‚‰ã®ã²ã¨ã“ã¨ï¼š** {role_msg}")
